---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const base = import.meta.env.BASE_URL;
const withBase = (path: string) => `${base}${path.replace(/^\//, "")}`;

export async function getStaticPaths() {
  const publications = await getCollection("publications");

  return publications.map((pub) => ({
    params: { slug: pub.slug },
    props: { pub },
  }));
}

const { pub } = Astro.props;
const { data } = pub;
const { Content } = await pub.render();
---

<BaseLayout
  title={`${data.title} — Publication`}
  description={`Academic publication in ${data.journal} (${data.year}).`}
>
  <article class="font-serif leading-relaxed text-slate-800">
    <nav class="mb-6 font-sans text-sm text-slate-500">
      <a href={withBase("/publications")} class="hover:underline">
        Publications
      </a>
      <span class="mx-2">→</span>
      <span class="text-slate-700">
        {data.title}
      </span>
    </nav>

    <header class="mb-8">
      <h1 class="font-sans text-3xl font-semibold">
        {data.title}
      </h1>

      <p class="mt-2 text-sm text-slate-500 font-sans">
        {data.journal} · {data.year}
      </p>

      <p class="mt-1 text-sm text-slate-500 font-sans">
        {data.authors.join(", ")}
      </p>

      {data.link ? (
        <a
          href={data.link}
          class="mt-4 inline-block font-sans text-sm text-blue-600 hover:underline"
          target="_blank"
          rel="noopener noreferrer"
        >
          View publication →
        </a>
      ) : (
        <span class="mt-4 inline-block font-sans text-sm text-slate-500">
          Link unavailable
        </span>
      )}
    </header>

    <section class="prose prose-slate max-w-none">
      <Content />
    </section>
  </article>
</BaseLayout>
