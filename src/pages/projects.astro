---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection, type CollectionEntry } from "astro:content";

const base = import.meta.env.BASE_URL;
const withBase = (path: string) => `${base}${path.replace(/^\//, "")}`;

const projects = await getCollection("projects");
const byNewest = (
  a: CollectionEntry<"projects">,
  b: CollectionEntry<"projects">,
) => b.data.year - a.data.year;
const sortedProjects = [...projects].sort(byNewest);

const courseLinks = [
  { match: "DataTalksClub", href: "https://datatalks.club" },
  { match: "ISEP", href: "https://www.isep.ipp.pt/Course/Course/325" },
  { match: "Le Wagon", href: "https://www.lewagon.com/data-science-course" },
];

const getCourseLink = (courseName: string) =>
  courseLinks.find((link) => courseName.includes(link.match))?.href;
---

<BaseLayout
  title="Projects — Daniel Osório"
  description="Selected data science and applied machine learning projects, focused on pricing, interpretability, and decision systems."
>
  <h1 class="text-2xl font-semibold">Projects</h1>

  <div class="mt-6 font-sans text-sm text-slate-600">
    Selected personal data science projects. Employer work and academic research projects are not included here.
  </div>

  <div class="mt-8 font-serif leading-relaxed text-slate-800">
    <ul class="space-y-6">
      {sortedProjects.map((project) => (
        <li class="rounded-sm border-l-2 border-slate-200 pl-4 transition-colors hover:bg-slate-50/60">
          <h2 class="font-medium">
            <a
              href={withBase(`/projects/${project.slug}`)}
              class="hover:underline underline-offset-4"
            >
              {project.data.title}
            </a>
          </h2>

          <p class="mt-1 text-sm text-slate-500">
            {project.data.year} · {project.data.stack.join(" · ")}
            {project.data.context && (
              <> · {project.data.context === "course" ? "Course" : "Independent"}</>
            )}
            {project.data.context === "course" && project.data.course_name && (
              <>
                {" · "}
                {getCourseLink(project.data.course_name) ? (
                  <a
                    href={getCourseLink(project.data.course_name)}
                    class="underline underline-offset-2"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    {project.data.course_name}
                  </a>
                ) : (
                  project.data.course_name
                )}
                {project.data.course_role && (
                  <span class="ml-2 rounded-full border border-slate-200 px-2 py-0.5 text-[10px] uppercase tracking-wide text-slate-500">
                    {project.data.course_role}
                  </span>
                )}
              </>
            )}
          </p>

          {project.data.repo && (
            <a
              class="mt-2 inline-flex items-center gap-2 text-sm text-slate-600 hover:text-slate-900"
              href={project.data.repo}
              rel="noopener noreferrer"
              target="_blank"
            >
              <svg
                aria-hidden="true"
                class="h-4 w-4"
                viewBox="0 0 16 16"
                fill="currentColor"
              >
                <path d="M8 0a8 8 0 0 0-2.53 15.6c.4.08.55-.17.55-.38v-1.33c-2.26.49-2.74-1.09-2.74-1.09-.36-.92-.88-1.17-.88-1.17-.72-.49.05-.48.05-.48.8.06 1.22.82 1.22.82.71 1.22 1.86.87 2.31.66.07-.52.28-.87.5-1.07-1.8-.2-3.69-.9-3.69-4a3.13 3.13 0 0 1 .83-2.17c-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82a7.6 7.6 0 0 1 4 0c1.53-1.03 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.52.58.83 1.3.83 2.17 0 3.1-1.9 3.8-3.7 4 .29.25.55.74.55 1.5v2.23c0 .21.15.46.55.38A8 8 0 0 0 8 0Z" />
              </svg>
              Repo
            </a>
          )}

        </li>
      ))}
    </ul>
  </div>
</BaseLayout>
