---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const projects = await getCollection("projects");

  return projects.map((project) => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

const { project } = Astro.props;
const { data } = project;
const { Content } = await project.render();

const courseLinks = [
  { match: "DataTalksClub", href: "https://datatalks.club" },
  { match: "ISEP", href: "https://www.isep.ipp.pt/Course/Course/325" },
  { match: "Le Wagon", href: "https://www.lewagon.com/data-science-course" },
];

const getCourseLink = (courseName) =>
  courseLinks.find((link) => courseName.includes(link.match))?.href;
---

<BaseLayout
  title={`${data.title} — Project`}
  description="Applied data science project focused on modeling, interpretation, and decision support."
>
  <article class="font-serif leading-relaxed text-slate-800">
    <nav class="mb-6 font-sans text-sm text-slate-500">
      <a href="/projects" class="hover:underline">
        Projects
      </a>
      <span class="mx-2">→</span>
      <span class="text-slate-700">
        {data.title}
      </span>
    </nav>

    <header class="mb-8">
      <h1 class="font-sans text-3xl font-semibold">
        {data.title}
      </h1>

      <div class="mt-3 space-y-2 text-sm text-slate-500 font-sans">
        <p>{data.year}</p>
        {data.context && (
          <p>{data.context === "course" ? "Course" : "Independent"}</p>
        )}
        {data.context === "course" && data.course_name && (
          <p class="flex flex-wrap items-center gap-2">
            {getCourseLink(data.course_name) ? (
              <a
                href={getCourseLink(data.course_name)}
                class="underline underline-offset-2"
                target="_blank"
                rel="noopener noreferrer"
              >
                {data.course_name}
              </a>
            ) : (
              data.course_name
            )}
            {data.course_role && (
              <span class="rounded-full border border-slate-200 px-2 py-0.5 text-[10px] uppercase tracking-wide text-slate-500">
                {data.course_role}
              </span>
            )}
          </p>
        )}
        <ul class="flex flex-wrap gap-2">
          {data.stack.map((item) => (
            <li class="rounded-full border border-slate-200 bg-white px-3 py-1 text-xs text-slate-600">
              {item}
            </li>
          ))}
        </ul>
      </div>

      {data.summary && (
        <p class="mt-4 text-slate-700 font-sans">
          {data.summary}
        </p>
      )}

      {data.repo && (
        <a
          class="mt-4 inline-flex items-center gap-2 text-sm text-slate-600 hover:text-slate-900 font-sans"
          href={data.repo}
          rel="noopener noreferrer"
          target="_blank"
        >
          <svg
            aria-hidden="true"
            class="h-4 w-4"
            viewBox="0 0 16 16"
            fill="currentColor"
          >
            <path d="M8 0a8 8 0 0 0-2.53 15.6c.4.08.55-.17.55-.38v-1.33c-2.26.49-2.74-1.09-2.74-1.09-.36-.92-.88-1.17-.88-1.17-.72-.49.05-.48.05-.48.8.06 1.22.82 1.22.82.71 1.22 1.86.87 2.31.66.07-.52.28-.87.5-1.07-1.8-.2-3.69-.9-3.69-4a3.13 3.13 0 0 1 .83-2.17c-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82a7.6 7.6 0 0 1 4 0c1.53-1.03 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.52.58.83 1.3.83 2.17 0 3.1-1.9 3.8-3.7 4 .29.25.55.74.55 1.5v2.23c0 .21.15.46.55.38A8 8 0 0 0 8 0Z" />
          </svg>
          Repo
        </a>
      )}

      {data.authors && data.authors.length > 0 && (
        <p class="mt-4 text-sm text-slate-600 font-sans">
          Collaborators: {data.authors.join(", ")}
        </p>
      )}

    </header>

    {(data.snapshot || data.architecture_diagram || data.video_url) && (
      <div class="mt-6 space-y-6 mb-6">
        {data.snapshot && (
          <figure>
            <img
              src={data.snapshot}
              alt={`${data.title} snapshot`}
              class="w-full max-w-2xl rounded-md border border-slate-200"
              loading="lazy"
            />
          </figure>
        )}

        {data.architecture_diagram && (
          <figure>
            <img
              src={data.architecture_diagram}
              alt={`${data.title} architecture diagram`}
              class="w-full max-w-2xl rounded-md border border-slate-200"
              loading="lazy"
            />
          </figure>
        )}

        {data.video_url && (
          <a
            href={data.video_url}
            class="inline-flex items-center gap-2 rounded-md bg-slate-900 px-3 py-1.5 text-sm text-white hover:bg-slate-800 font-sans"
            target="_blank"
            rel="noopener noreferrer"
          >
            Watch demo video →
          </a>
        )}
      </div>
    )}

    <section class="prose prose-slate max-w-none">
      <Content />
    </section>
  </article>
</BaseLayout>
